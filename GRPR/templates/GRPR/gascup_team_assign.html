{% extends "base.html" %}
{% load custom_filters %}
{% block title %}{% if variant == "FallClassic" %}Fall Classic Teams{% else %}Gas Cup Teams{% endif %}{% endblock %}

{% block content %}
<h3 class="mb-3">Assign Teams – {% if variant == "FallClassic" %}Fall Classic{% else %}Gas Cup{% endif %}</h3>


{% if messages %}
  {% for m in messages %}
    <div class="alert alert-{{ m.tags|default:'info' }} py-1 small">
      {{ m }}
    </div>
  {% endfor %}
{% endif %}

<form method="post" class="table-responsive">
  {% csrf_token %}

  {# ── regroup players by tee-time slot ─────────────────────────── #}
  {% regroup players by TTID.CourseID.courseTimeSlot as groups %}

  <table class="table table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th>Player</th>
          <th class="text-center">{{ teams.0 }}</th>
          <th class="text-center">{{ teams.1 }}</th>
        </tr>
      </thead>

      {% for g in groups %}
        {# group header ------------------------------------------------ #}
        <tbody>
          <tr class="table-secondary fw-bold">
            <td colspan="3" class="text-center">
              {{ g.grouper }} tee-time
            </td>
          </tr>

          {# player rows ------------------------------------------------ #}
          {% for inv in g.list %}
            <tr class="group-row">
              <td>
                {{ inv.PID.FirstName }} {{ inv.PID.LastName }}
                <small class="text-muted">({{ g.grouper }})</small>
              </td>

              {% for team in teams %}
                <td class="text-center">
                  <input type="radio"
                         name="p_{{ inv.PID_id }}"
                         value="{{ team }}"
                         {% if assignments and assignments|dict_get:inv.PID_id == team %}checked{% endif %}
                         required>
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      {% endfor %}
  </table>

  <button class="btn btn-primary">Continue</button>
  <a href="{% url 'games_view' %}" class="btn btn-secondary">Cancel</a>
</form>
{% endblock %}
