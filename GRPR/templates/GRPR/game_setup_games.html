{% extends "base.html" %}
{% load static %}

{% block title %}Start New Game · Choose Games{% endblock %}

{% block content %}
<div class="container py-4" style="max-width: 1000px;">

  <h1 class="mb-1">Start New Game</h1>
  <p class="text-muted mb-3">Step 6 of 6 — Choose which games to play.</p>

  {% if progress %}
    <div class="mb-3">
      <div class="progress" style="height: 10px;">
        <div class="progress-bar" role="progressbar"
             style="width: {{ progress_pct }};"
             aria-valuenow="{{ progress.current }}"
             aria-valuemin="0" aria-valuemax="{{ progress.total }}">
        </div>
      </div>
      <div class="small text-muted mt-1">
        {{ progress.labels.0 }} ▸ {{ progress.labels.1 }} ▸ {{ progress.labels.2 }} ▸
        {{ progress.labels.3 }} ▸ {{ progress.labels.4 }} ▸ {{ progress.labels.5 }}
      </div>
    </div>
  {% endif %}

  <div class="row g-3">
    <!-- Left: Summary -->
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header">Your configuration</div>
        <div class="card-body">
          <div class="mb-2"><strong>Date:</strong> {{ playing_date|date:"D, M j, Y" }}</div>
          <div class="mb-2"><strong>Course:</strong> {{ course_name }}</div>
          <div class="mb-2"><strong>Players:</strong> {{ number_of_players }}</div>
          <div class="mb-2"><strong>Tee set:</strong> {{ tee_label }}</div>
          <div class="mb-3"><strong>Handicap mode:</strong> {{ handicap_mode }}</div>

          <hr>
          <div class="mb-2"><strong>Tee times & groups:</strong></div>
          {% if tee_times %}
            <ul class="list-unstyled mb-0">
              {% for grp in tee_times %}
                <li class="mb-2">
                  <span class="badge bg-secondary me-2">{{ grp.label }}</span>
                  {% for p in grp.players %}
                    <span class="badge bg-light text-dark me-1">{{ p.name }}</span>
                  {% endfor %}
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="text-muted">No assignments found.</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Right: Game choices -->
    <div class="col-lg-6">
      <form method="post" class="card h-100" action="{% url 'game_setup_route' %}">
        {% csrf_token %}
        <div class="card-header">Which games do you want to play?</div>
        <div class="card-body">
          <div class="row g-3">
            <!-- Skins -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="game-card" tabindex="0">
                <input class="visually-hidden" type="checkbox" id="g_skins" name="games" value="skins"
                       {% if 'skins' in selected_games %}checked{% endif %}>
                <div class="game-card-body">
                  <div class="game-card-title">Skins</div>
                  <div class="game-card-sub">Low score per hole wins a skin</div>
                </div>
              </label>
            </div>

            <!-- Forty -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="game-card" tabindex="0">
                <input class="visually-hidden" type="checkbox" id="g_forty" name="games" value="forty"
                       {% if 'forty' in selected_games %}checked{% endif %}>
                <div class="game-card-body">
                  <div class="game-card-title">Forty</div>
                  <div class="game-card-sub">Best N net scores per group</div>
                </div>
              </label>
            </div>

            <!-- Gas Cup (admin toggle) -->
            {% if enable_gas_cup %}
            <div class="col-12 col-md-6 col-lg-4">
              <label class="game-card" tabindex="0">
                <input class="visually-hidden" type="checkbox" id="g_gascup" name="games" value="gascup"
                       {% if 'gascup' in selected_games %}checked{% endif %}>
                <div class="game-card-body">
                  <div class="game-card-title">Gas Cup</div>
                  <div class="game-card-sub">Team match play</div>
                </div>
              </label>
            </div>
            {% endif %}

            <!-- Fall Classic (admin toggle) -->
            {% if enable_fall_classic %}
            <div class="col-12 col-md-6 col-lg-4">
              <label class="game-card" tabindex="0">
                <input class="visually-hidden" type="checkbox" id="g_fallclassic" name="games" value="fallclassic"
                       {% if 'fallclassic' in selected_games %}checked{% endif %}>
                <div class="game-card-body">
                  <div class="game-card-title">Fall Classic</div>
                  <div class="game-card-sub">Cubs vs. Sox teams</div>
                </div>
              </label>
            </div>
            {% endif %}

            <!-- Stableford (new) -->
            <div class="col-12 col-md-6 col-lg-4">
              <label class="game-card" tabindex="0">
                <input class="visually-hidden" type="checkbox" id="g_stableford" name="games" value="stableford"
                       {% if 'stableford' in selected_games %}checked{% endif %}>
                <div class="game-card-body">
                  <div class="game-card-title">Stableford</div>
                  <div class="game-card-sub">Points by score (e.g., 2=par, 3=birdie)</div>
                </div>
              </label>
            </div>
          </div>
        </div>

        <div class="card-footer d-flex gap-2">
          <button class="btn btn-primary" type="submit">Kontinue</button>
          <a class="btn btn-outline-secondary" href="{% url 'game_setup_config' %}">Back</a>
        </div>
      </form>
    </div>
  </div>

</div>
{% endblock %}

{# Optional: tiny keyboard helper if you want explicit JS toggling #}
<script>
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.game-card').forEach(card => {
    card.addEventListener('keydown', (e) => {
      if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        const cb = card.querySelector('input[type="checkbox"]');
        if (cb) { cb.checked = !cb.checked; cb.dispatchEvent(new Event('change')); }
      }
    });
  });
});
</script>
